<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NCEPLIBS-w3emc: w3fi72.f File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NCEPLIBS-w3emc<span id="projectnumber">&#160;2.9.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('w3fi72_8f.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle"><div class="title">w3fi72.f File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Make a complete grib message.  
<a href="#details">More...</a></p>

<p><a href="w3fi72_8f_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:aaac6e022f341c919316466672ef3e70c"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="w3fi72_8f.html#aaac6e022f341c919316466672ef3e70c">w3fi72</a> (ITYPE, FLD, IFLD, IBITL, IPFLAG, ID, PDS, IGFLAG, IGRID, IGDS, ICOMP, IBFLAG, IBMAP, IBLEN, IBDSFL, NPTS, KBUF, ITOT, JERR)</td></tr>
<tr class="memdesc:aaac6e022f341c919316466672ef3e70c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Makes a complete grib message from a user supplied array of floating point or integer data.  <a href="w3fi72_8f.html#aaac6e022f341c919316466672ef3e70c">More...</a><br /></td></tr>
<tr class="separator:aaac6e022f341c919316466672ef3e70c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Make a complete grib message. </p>
<dl class="section author"><dt>Author</dt><dd>Ralph Jones </dd></dl>
<dl class="section date"><dt>Date</dt><dd>1991-05-08 </dd></dl>

<p class="definition">Definition in file <a class="el" href="w3fi72_8f_source.html">w3fi72.f</a>.</p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="aaac6e022f341c919316466672ef3e70c" name="aaac6e022f341c919316466672ef3e70c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaac6e022f341c919316466672ef3e70c">&#9670;&nbsp;</a></span>w3fi72()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine w3fi72 </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ITYPE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(*)&#160;</td>
          <td class="paramname"><em>FLD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(*)&#160;</td>
          <td class="paramname"><em>IFLD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>IBITL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>IPFLAG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(*)&#160;</td>
          <td class="paramname"><em>ID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character * 1, dimension(*)&#160;</td>
          <td class="paramname"><em>PDS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>IGFLAG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>IGRID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(*)&#160;</td>
          <td class="paramname"><em>IGDS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ICOMP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>IBFLAG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(*)&#160;</td>
          <td class="paramname"><em>IBMAP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>IBLEN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(*)&#160;</td>
          <td class="paramname"><em>IBDSFL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>NPTS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character * 1, dimension(*)&#160;</td>
          <td class="paramname"><em>KBUF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ITOT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>JERR</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Makes a complete grib message from a user supplied array of floating point or integer data. </p>
<p >The user has the option of supplying the pds or an integer array that will be used to create a pds (with <a class="el" href="w3fi68_8f.html#a627b0d3ff494874dd3fb243e39cfa991" title="Converts an array of 25, or 27 integer words into a grib product definition section (pds) of 28 bytes...">w3fi68()</a>). The user must also supply other necessary info; See usage section below.</p>
<p >Program history log:</p><ul>
<li>Ralph Jones 1991-05-08</li>
<li>M. Farley 1992-07-01 Added gds and bms logic. Placed existing logic for bds in a routine.</li>
<li>Ralph Jones 1992-10-02 Add error exit for <a class="el" href="w3fi73_8f.html#a89eedc9b7ba4fd46b1f6ac9eba1f773e" title="This subroutine constructs a grib bit map section.">w3fi73()</a></li>
<li>Ralph Jones 1993-04-30 Replace do loops to move character data with xmovex, use xstore to zero character array. make change so flat field will pack.</li>
<li>Bill Cavanaugh 1993-08-06 Modified call to w3fi75</li>
<li>Bill Cavanaugh 1993-10-26 Added code to restore input field to original values if d-scale not 0</li>
<li>Bill Cavanaugh 1994-01-27 Added igds array in call to w3fi75 to provide information for boustrophedonic processing</li>
<li>Bill Cavanaugh 1994-03-03 Increased size of gds array for thin grids</li>
<li>M. Farley 1994-05-16 Cleaned up documentation</li>
<li>M. Farley 1994-11-10 Increased size of pfld/ifld arrarys from 100k to 260k for .5 degree sst anal fields</li>
<li>Ralph Jones 1994-12-04 Change document for ipflag.</li>
<li>Mark Iredell 1995-10-31 Removed saves and prints</li>
<li>Stephen Gilbert 1998-05-19 Increased array dimensions to handle grids of up to 500,000 grid points.</li>
<li>Mark Iredell 1995-10-31 Generalized word size</li>
<li>Stephen Gilbert 1998-12-21 Replaced Function ICHAR with mova2i.</li>
<li>Stephen Gilbert 1999-02-01 Changed the method of zeroing out array KBUF. the old method, using W3FI01() and XSTORE() was incorrect with 4-byte integers and 8-byte reals.</li>
<li>Stephen Gilbert 2001-06-07 Removed calls to xmovex. changed IPFLD from integer to character.</li>
<li>George Gayno 2010-02-19 Fix allocation of array bms</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ITYPE</td><td><ul>
<li>0 = Floating point data supplied in array 'fld'</li>
<li>1 = Integer data supplied in array 'ifld' </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">FLD</td><td>Real array of data (at proper gridpoints) to be converted to grib format if itype=0. see remarks #1 &amp; 2. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">IFLD</td><td>Integer array of data (at proper gridpoints) to be converted to grib format if itype=1. See remarks #1 &amp; 2. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">IBITL</td><td><ul>
<li>0 = Computer computes length for packing data from power of 2 (number of bits) best fit of data using 'variable' bit packer <a class="el" href="w3fi58_8f.html#a9e29ba5f6e80a0133fdf08c4374d6e5e" title="Converts an array of integer numbers into an array of positive differences (number(s) - minimum value...">w3fi58()</a>.</li>
<li>8, 12, Etc. computer rescales data to fit into that 'fixed' number of bits using <a class="el" href="w3fi59_8f.html#ab4f28b2c5e95c681036ef83142a58601" title="Converts an array of single precision real numbers into an array of positive scaled differences (numb...">w3fi59()</a>. See remarks #3. </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">IPFLAG</td><td><ul>
<li>0 = Make pds from user supplied array (id)</li>
<li>1 = User supplying pds </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>If pds is greater than 30, use iplfag=1. The user could call <a class="el" href="w3fi68_8f.html#a627b0d3ff494874dd3fb243e39cfa991" title="Converts an array of 25, or 27 integer words into a grib product definition section (pds) of 28 bytes...">w3fi68()</a> before he calls <a class="el" href="w3fi72_8f.html#aaac6e022f341c919316466672ef3e70c" title="Makes a complete grib message from a user supplied array of floating point or integer data.">w3fi72()</a>. This would make the first 30 bytes of the pds, user then would make bytes after 30. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ID</td><td>Integer array of values that <a class="el" href="w3fi68_8f.html#a627b0d3ff494874dd3fb243e39cfa991" title="Converts an array of 25, or 27 integer words into a grib product definition section (pds) of 28 bytes...">w3fi68()</a> will use to make an edition 1 pds if ipflag=0. (see the docblock for <a class="el" href="w3fi68_8f.html#a627b0d3ff494874dd3fb243e39cfa991" title="Converts an array of 25, or 27 integer words into a grib product definition section (pds) of 28 bytes...">w3fi68()</a> for layout of array) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">PDS</td><td>Character array of values (valid pds supplied by user) if ipflag=1. length may exceed 28 bytes (contents of bytes beyond 28 are passed through unchanged). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">IGFLAG</td><td><ul>
<li>0 = Make gds based on 'igrid' value.</li>
<li>1 = Make gds from user supplied info in 'igds' and 'igrid' value. See remarks #4. </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">IGRID</td><td><ul>
<li># = Grid identification (table b)</li>
<li>255 = If user defined grid; igds must be supplied and igflag must =1. </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">IGDS</td><td>Integer array containing user gds info (same format as supplied by <a class="el" href="w3fi71_8f.html#add1b6b2b2c9fda60094914f5e676ec42" title="W3FI71 Makes a 18, 37, 55, 64, or 91 word integer array used by w3fi72() grib packer to make the grid...">w3fi71()</a> - see dockblock for layout) if igflag=1. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ICOMP</td><td>Resolution and component flag for bit 5 of gds(17)<ul>
<li>0 = Earth oriented winds</li>
<li>1 = Grid oriented winds </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">IBFLAG</td><td><ul>
<li>0 = Make bit map from user supplied data</li>
<li># = Bit map predefined by center. See remarks #5. </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">IBMAP</td><td>Integer array containing bit map </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">IBLEN</td><td>Length of bit map will be used to verify length of field (error if it doesn't match). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">IBDSFL</td><td>Integer array containing table 11 flag info<ul>
<li>BDS octet 4:</li>
<li>(1)<ul>
<li>0 = Grid point data</li>
<li>1 = Spherical harmonic coefficients</li>
</ul>
</li>
<li>(2) 0 = Simple packing<ul>
<li>1 = Second order packing</li>
</ul>
</li>
<li>(3) ... Same value as 'itype'<ul>
<li>0 = Original data were floating point values</li>
<li>1 = Original data were integer values</li>
</ul>
</li>
<li>(4) 0 = No additional flags at octet 14<ul>
<li>1 = Octet 14 contains flag bits 5-12</li>
</ul>
</li>
<li>(5) 0 = Reserved - always set to 0 Byte 6 option 1 not available (as of 5-16-93)</li>
<li>(6) 0 = Single datum at each grid point<ul>
<li>1 = Matrix of values at each grid point Byte 7 option 0 with second order packing n/a (as of 5-16-93)</li>
</ul>
</li>
<li>(7) 0 = No secondary bit maps<ul>
<li>1 = Secondary bit maps present</li>
</ul>
</li>
<li>(8) 0 = Second order values have constant width<ul>
<li>1 = Second order values have different widths </li>
</ul>
</li>
</ul>
</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">NPTS</td><td>Number of gridpoints in array fld or ifld </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">KBUF</td><td>Entire grib message ('grib' to '7777') equivalence to integer array to make sure it is on word boundary. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ITOT</td><td>Total length of grib message in bytes </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">JERR</td><td><ul>
<li>= 0, Completed making grib field without error</li>
<li>= 1, Ipflag not 0 or 1</li>
<li>= 2, Igflag not 0 or 1</li>
<li>= 3, Error converting ieee f.p. number to ibm370 f.p.</li>
<li>= 4, W3fi71() error/igrid not defined</li>
<li>= 5, W3fk74() error/grid representation type not valid</li>
<li>= 6, Grid too large for packer dimension arrays</li>
<li>= See automation division for revision!</li>
<li>= 7, Length of bit map not equal to size of fld/ifld</li>
<li>= 8, W3fi73() error, all values in ibmap are zero</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>1: If bit map to be included in message, null data should be included in fld or ifld. this routine will take care of 'discarding' any null data based on the bit map.</li>
<li>2: Units must be those in grib documentation: nmc o.n. 388 or wmo publication 306.</li>
<li>3: In either case, input numbers will be multiplied by '10 to the nth' power found in id(25) or pds(27-28), the d-scaling factor, prior to binary packing.</li>
<li>4: All nmc produced grib fields will have a grid definition section included in the grib message. id(6) will be set to '1'.<ul>
<li>GDS will be built based on grid number (igrid), unless igflag=1 (user supplying igds). user must still supply igrid even if igds provided.</li>
</ul>
</li>
<li>5: if bit map used then id(7) or pds(8) must indicate the presence of a bit map.</li>
<li>6: Array kbuf should be equivalenced to an integer value or array to make sure it is on a word boundary.</li>
<li>7: Subprogram can be called from a multiprocessing environment.</li>
</ul>
</dd></dl>
<dl class="section author"><dt>Author</dt><dd>Ralph Jones </dd></dl>
<dl class="section date"><dt>Date</dt><dd>1991-05-08 </dd></dl>

<p class="definition">Definition at line <a class="el" href="w3fi72_8f_source.html#l00146">146</a> of file <a class="el" href="w3fi72_8f_source.html">w3fi72.f</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="w3fi72_8f.html">w3fi72.f</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
